<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Crux — Web3 Social dApp</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@100..900&display=swap" rel="stylesheet">
  

  <style>
    
    
    
  </style>
</head>

<body class="relative min-h-screen bg-black text-white flex flex-col items-center justify-center px-4 text-center overflow-hidden">
  <!-- Background -->
  <div class="absolute inset-0 z-0 animated-bg opacity-20" style="background-image: url('./ethpic.jpg');"></div>

  <!-- Content -->
  <main class="z-10 max-w-xl">
    <h1 class="text-4xl md:text-5xl font-extrabold mb-4 tracking-tight font-[Outfit]">Crux</h1>
    <p class="text-gray-300 mb-8 text-xl font-[Sora]">
      A decentralized social network powered by Ethereum — create, share, and connect without limits.
    </p>
    <!-- Name Input -->
<input
  type="text"
  id="nameInput"
  placeholder="Enter your name"
  class="w-full mb-6 text-white text-lg font-[Outfit] bg-transparent border-b-2 border-yellow-400 placeholder-gray-400 
         focus:outline-none 
         transition-all duration-300 
         hover:animate-pulse-glow 
         focus:border-purple-500 
         focus:shadow-[0_0_20px_6px_rgba(168,85,247,0.8)]"
/>


<!-- Connect Button -->
<button id="connectBtn"
  class="bg-[#6b46c1] text-white px-6 py-3 rounded-xl text-lg font-medium transition-all duration-300 ease-in-out
         shadow-md hover:shadow-[0_8px_30px_rgba(107,70,193,0.6)]
         hover:scale-[1.02] focus:outline-none focus:ring-4 focus:ring-purple-500/50">
  Connect Wallet
</button>



  </main>

  <!-- Modal -->
  <div id="popup" class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 hidden">
  <div class="bg-gray-900 text-white p-6 rounded-2xl shadow-2xl w-[90%] max-w-sm text-center">
    <h2 class="text-2xl font-bold mb-4">✅ Connected Successfully</h2>
    <p class="mb-2 text-gray-300">You're now ready to explore Crux.</p>
    <p class="mb-6 text-purple-400 text-sm" id="walletAddress"></p>
    <button id="continueBtn" class="bg-purple-600 hover:bg-purple-700 px-6 py-2 rounded-lg transition-all">
      Continue
    </button>
  </div>
</div>


  <!-- Cursor -->
  
  <div id="cursor" class="pointer-events-none fixed w-5 h-5 rounded-full bg-purple-600 shadow-lg z-50"></div>
  <!-- Name Required Popup -->
<div id="namePopup" class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 hidden">
  <div class="bg-gray-900 text-white p-6 rounded-xl shadow-2xl w-[90%] max-w-sm text-center animate-pulse border border-yellow-500">
    <h2 class="text-xl font-bold text-yellow-400 mb-2">⚠️ Name Required</h2>
    <p class="text-sm text-gray-300">Please enter your name before connecting your wallet.</p>
    <button id="closeNamePopup" class="mt-4 px-4 py-2 bg-yellow-500 hover:bg-yellow-400 text-black font-medium rounded-lg">
      Got it!
    </button>
  </div>
</div>

<!-- Vibration sound -->
<audio id="vibrateSound" src="./wrong.mp3" preload="auto"></audio>


<script type="module">
   import { ethers } from "https://cdn.jsdelivr.net/npm/ethers@6.8.1/+esm";

// Initialize the coin sound effect
const coinSound = new Audio('./coin.mp3'); // Make sure this path is correct

function onWalletConnected(account) {
  const popup = document.getElementById("popup");
  const continueBtn = document.getElementById("continueBtn");
  const addressDisplay = document.getElementById("walletAddress");

  // Show connected account in popup
  addressDisplay.textContent = `Connected wallet: ${account}`;

  // Show the popup
  popup.classList.remove("hidden");
  continueBtn.focus();

  // ✅ Store connection state
  localStorage.setItem("walletConnected", "true");
  localStorage.setItem("userWallet", account);

  // Play retro coin sound
  coinSound.play().catch((e) => {
    console.warn("Sound playback failed:", e);
  });

  // Continue button click handler
  continueBtn.addEventListener("click", () => {
  const name = document.getElementById("nameInput")?.value?.trim();
  if (name) {
    localStorage.setItem("username", name);
  }
  window.location.href = "./home.html";
});


  window.addEventListener("keydown", (e) => {
    if (e.key === "Enter" && !popup.classList.contains("hidden")) {
      window.location.href = "./home.html";
    }
  });
}

window.onload = () => {
      const btn = document.getElementById("connectBtn");

      btn.onclick = async () => {
        const nameInput = document.getElementById("nameInput");
        const name = nameInput?.value?.trim();

        if (!name) {
          const namePopup = document.getElementById("namePopup");
          namePopup.classList.remove("hidden");

          document.body.classList.add("vibrate");
          setTimeout(() => document.body.classList.remove("vibrate"), 300);

          vibrateSound.play().catch(() => {});
          return;
        }

        try {
          const provider = new ethers.BrowserProvider(window.ethereum);
          const accounts = await provider.send("eth_requestAccounts", []);
          if (!accounts || accounts.length === 0) return alert("No account found!");

          const account = accounts[0];
          btn.innerText = "☑ " + account.slice(0, 6) + "..." + account.slice(-4);

          localStorage.setItem("username", name);
          onWalletConnected(account);
        } catch (error) {
          console.error("Connection failed", error);
          alert("Connection failed!");
        }
      };
}
document.getElementById("closeNamePopup").onclick = () => {
  document.getElementById("namePopup").classList.add("hidden");
};

     const cursor = document.getElementById("cursor");
let mouseX = 0, mouseY = 0;
let currentX = 0, currentY = 0;

window.addEventListener("mousemove", (e) => {
  mouseX = e.clientX;
  mouseY = e.clientY;
});

function animate() {
  currentX += (mouseX - currentX) * 0.15;
  currentY += (mouseY - currentY) * 0.15;
  cursor.style.left = currentX + "px";
  cursor.style.top = currentY + "px";
  requestAnimationFrame(animate);
}

animate();

  </script>
</body>
</html>
